================================================================================
AUTH & USER SERVICE - POSTMAN TESTING GUIDE
================================================================================
Service Port: 3001
Base URL: http://localhost:3001/api/v1


================================================================================
1. AUTHENTICATION ENDPOINTS
================================================================================

1.1. REGISTER NEW USER
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/register

Body (JSON) - Client:
{
  "username": "johndoe",
  "email": "john@example.com",
  "password": "SecurePass123!",
  "firstName": "John",
  "lastName": "Doe",
  "role": "client",
  "phoneNumber": "+1234567890"
}

Body (JSON) - Agency:
{
  "username": "rentalagency",
  "email": "agency@example.com",
  "password": "AgencyPass123!",
  "firstName": "Rental",
  "lastName": "Agency",
  "role": "agency",
  "phoneNumber": "+1234567890"
}

Expected Response:
{
  "success": true,
  "message": "User registered successfully",
  "data": {
    "user": {
      "_id": "...",
      "username": "johndoe",
      "email": "john@example.com",
      "role": "client",
      ...
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}

1.2. LOGIN
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/login

Body (JSON):
{
  "username": "johndoe",
  "password": "SecurePass123!"
}

OR with email:
{
  "email": "john@example.com",
  "password": "SecurePass123!"
}

Expected Response (No 2FA):
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {
      "_id": "...",
      "username": "johndoe",
      "email": "john@example.com",
      "role": "client",
      ...
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}

Expected Response (2FA Enabled):
{
  "success": true,
  "message": "2FA verification required",
  "requires2FA": true,
  "tempToken": "temp_token_for_2fa_verification"
}

1.3. LOGIN WITH 2FA
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/login-2fa

Body (JSON):
{
  "tempToken": "temp_token_from_login_response",
  "token": "123456"
}

Expected Response:
{
  "success": true,
  "message": "Login successful",
  "data": {
    "user": {...},
    "accessToken": "...",
    "refreshToken": "..."
  }
}

1.4. REFRESH TOKEN
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/refresh-token

Body (JSON):
{
  "refreshToken": "your_refresh_token_here"
}

Expected Response:
{
  "success": true,
  "accessToken": "new_access_token",
  "refreshToken": "new_refresh_token"
}

1.5. LOGOUT
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/logout
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "refreshToken": "your_refresh_token_here"
}

Expected Response:
{
  "success": true,
  "message": "Logout successful"
}

1.6. ENABLE FACE AUTHENTICATION
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/enable-face-auth
Headers: Authorization: Bearer ACCESS_TOKEN

Body (form-data):
- images: [File] (Upload 5-10 face images)

Expected Response:
{
  "success": true,
  "message": "Face authentication enabled successfully",
  "faceId": "unique_face_id"
}

1.7. LOGIN WITH FACE
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/auth/login-face

Body (form-data):
- username: johndoe
- image: [File] (Single face image)

Expected Response:
{
  "success": true,
  "message": "Face authentication successful",
  "data": {
    "user": {...},
    "accessToken": "...",
    "refreshToken": "..."
  }
}

================================================================================
2. USER PROFILE ENDPOINTS
================================================================================

2.1. GET USER PROFILE
--------------------------------------------------------------------------------
GET http://localhost:3001/api/v1/users/profile
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "_id": "...",
    "username": "johndoe",
    "email": "john@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "role": "client",
    "phoneNumber": "+1234567890",
    "profilePicture": "uploads/profiles/...",
    "kycStatus": "pending",
    "isEmailVerified": true,
    "twoFactorEnabled": false,
    "faceAuthEnabled": false,
    "createdAt": "2025-11-26T...",
    ...
  }
}

2.2. UPDATE USER PROFILE
--------------------------------------------------------------------------------
PUT http://localhost:3001/api/v1/users/profile
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "firstName": "Jonathan",
  "lastName": "Doe",
  "phoneNumber": "+1234567899",
  "address": {
    "street": "123 Main St",
    "city": "New York",
    "state": "NY",
    "zipCode": "10001",
    "country": "USA"
  }
}

Expected Response:
{
  "success": true,
  "message": "Profile updated successfully",
  "data": {
    "_id": "...",
    "firstName": "Jonathan",
    ...
  }
}

2.3. UPLOAD PROFILE PICTURE
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/users/profile/picture
Headers: Authorization: Bearer ACCESS_TOKEN

Body (form-data):
- profilePicture: [File] (Image file)

Expected Response:
{
  "success": true,
  "message": "Profile picture uploaded successfully",
  "data": {
    "profilePicture": "uploads/profiles/user-123-1637856789.jpg"
  }
}

2.4. DELETE PROFILE PICTURE
--------------------------------------------------------------------------------
DELETE http://localhost:3001/api/v1/users/profile/picture
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "message": "Profile picture deleted successfully"
}

================================================================================
3. KYC (KNOW YOUR CUSTOMER) ENDPOINTS
================================================================================

3.1. SUBMIT KYC DOCUMENTS
--------------------------------------------------------------------------------
POST http://localhost:3001/api/v1/kyc/submit
Headers: Authorization: Bearer ACCESS_TOKEN

Body (form-data):
- nationalIdFront: [File]
- nationalIdBack: [File]
- drivingLicenseFront: [File]
- drivingLicenseBack: [File]
- proofOfAddress: [File]
- selfie: [File]

Expected Response:
{
  "success": true,
  "message": "KYC documents submitted successfully",
  "data": {
    "kycStatus": "pending",
    "documents": [
      {
        "type": "nationalIdFront",
        "url": "uploads/kyc/...",
        "uploadedAt": "2025-11-26T..."
      },
      ...
    ]
  }
}

3.2. GET KYC STATUS
--------------------------------------------------------------------------------
GET http://localhost:3001/api/v1/kyc/status
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "kycStatus": "approved",
    "documents": [
      {
        "_id": "...",
        "type": "nationalIdFront",
        "url": "uploads/kyc/...",
        "status": "approved",
        "uploadedAt": "2025-11-26T..."
      },
      ...
    ],
    "reviewedAt": "2025-11-26T...",
    "reviewedBy": "admin_id"
  }
}

3.3. DELETE KYC DOCUMENT
--------------------------------------------------------------------------------
DELETE http://localhost:3001/api/v1/kyc/documents/{documentId}
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "message": "Document deleted successfully"
}

================================================================================
4. KYC ADMIN ENDPOINTS (Admin Only)
================================================================================

4.1. GET PENDING KYC SUBMISSIONS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/kyc/admin/pending
Headers: Authorization: Bearer ADMIN_TOKEN

Query Parameters:
- page: 1
- limit: 10

Expected Response:
{
  "success": true,
  "data": [
    {
      "_id": "user_id",
      "username": "johndoe",
      "email": "john@example.com",
      "kycStatus": "pending",
      "submittedAt": "2025-11-26T...",
      "documents": [...]
    },
    ...
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 3,
    "totalItems": 25
  }
}

4.2. GET KYC DETAILS FOR USER
--------------------------------------------------------------------------------
GET http://localhost:3000/api/kyc/admin/{userId}
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "user": {
      "_id": "...",
      "username": "johndoe",
      "email": "john@example.com",
      "kycStatus": "pending"
    },
    "documents": [
      {
        "_id": "...",
        "type": "nationalIdFront",
        "url": "uploads/kyc/...",
        "status": "pending",
        "uploadedAt": "2025-11-26T..."
      },
      ...
    ]
  }
}

4.3. REVIEW KYC SUBMISSION
--------------------------------------------------------------------------------
POST http://localhost:3000/api/kyc/admin/{userId}/review
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON) - Approve:
{
  "status": "approved",
  "comments": "All documents verified successfully"
}

Body (JSON) - Reject:
{
  "status": "rejected",
  "comments": "National ID image is not clear. Please resubmit.",
  "rejectedDocuments": ["nationalIdFront"]
}

Expected Response:
{
  "success": true,
  "message": "KYC reviewed successfully",
  "data": {
    "kycStatus": "approved",
    "reviewedAt": "2025-11-26T...",
    "reviewedBy": "admin_id"
  }
}

4.4. GET KYC STATISTICS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/kyc/admin/stats
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "total": 150,
    "pending": 25,
    "approved": 100,
    "rejected": 25,
    "averageReviewTime": 48.5
  }
}

================================================================================
5. TWO-FACTOR AUTHENTICATION (2FA) ENDPOINTS
================================================================================

5.1. ENABLE 2FA
--------------------------------------------------------------------------------
POST http://localhost:3000/api/2fa/enable
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "message": "2FA setup initiated",
  "data": {
    "qrCode": "data:image/png;base64,...",
    "secret": "JBSWY3DPEHPK3PXP",
    "backupCodes": [
      "12345678",
      "87654321",
      ...
    ]
  }
}

5.2. VERIFY 2FA SETUP
--------------------------------------------------------------------------------
POST http://localhost:3000/api/2fa/verify-setup
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "token": "123456"
}

Expected Response:
{
  "success": true,
  "message": "2FA enabled successfully"
}

5.3. DISABLE 2FA
--------------------------------------------------------------------------------
POST http://localhost:3000/api/2fa/disable
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "token": "123456"
}

OR with backup code:
{
  "backupCode": "12345678"
}

Expected Response:
{
  "success": true,
  "message": "2FA disabled successfully"
}

5.4. VERIFY 2FA TOKEN
--------------------------------------------------------------------------------
POST http://localhost:3000/api/2fa/verify
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "token": "123456"
}

Expected Response:
{
  "success": true,
  "message": "Token verified successfully",
  "valid": true
}

5.5. GET 2FA STATUS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/2fa/status
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "twoFactorEnabled": true,
    "backupCodesRemaining": 8
  }
}

5.6. REGENERATE BACKUP CODES
--------------------------------------------------------------------------------
POST http://localhost:3000/api/2fa/regenerate-backup-codes
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "token": "123456"
}

Expected Response:
{
  "success": true,
  "message": "Backup codes regenerated",
  "backupCodes": [
    "12345678",
    "87654321",
    ...
  ]
}

================================================================================
6. PASSWORD RESET ENDPOINTS
================================================================================

6.1. REQUEST PASSWORD RESET
--------------------------------------------------------------------------------
POST http://localhost:3000/api/password-reset/request-reset

Body (JSON):
{
  "email": "john@example.com"
}

Expected Response:
{
  "success": true,
  "message": "Password reset email sent"
}

6.2. RESET PASSWORD
--------------------------------------------------------------------------------
POST http://localhost:3000/api/password-reset/reset

Body (JSON):
{
  "token": "reset_token_from_email",
  "newPassword": "NewSecurePass123!"
}

Expected Response:
{
  "success": true,
  "message": "Password reset successfully"
}

6.3. CHANGE PASSWORD (Authenticated)
--------------------------------------------------------------------------------
POST http://localhost:3000/api/password-reset/change
Headers: Authorization: Bearer ACCESS_TOKEN

Body (JSON):
{
  "currentPassword": "SecurePass123!",
  "newPassword": "NewSecurePass123!"
}

Expected Response:
{
  "success": true,
  "message": "Password changed successfully"
}

================================================================================
7. LOGIN HISTORY ENDPOINTS
================================================================================

7.1. GET MY RECENT LOGIN ACTIVITY
--------------------------------------------------------------------------------
GET http://localhost:3000/api/login-history/my-history
Headers: Authorization: Bearer ACCESS_TOKEN

Expected Response:
{
  "success": true,
  "data": [
    {
      "_id": "...",
      "loginTime": "2025-11-26T10:30:00Z",
      "ipAddress": "192.168.1.1",
      "userAgent": "Mozilla/5.0...",
      "device": "Desktop",
      "browser": "Chrome",
      "os": "Windows 10",
      "location": {
        "city": "New York",
        "country": "USA"
      },
      "success": true
    },
    ...
  ]
}

7.2. GET FULL LOGIN HISTORY
--------------------------------------------------------------------------------
GET http://localhost:3000/api/login-history/my-history/full
Headers: Authorization: Bearer ACCESS_TOKEN

Query Parameters:
- page: 1
- limit: 20

Expected Response:
{
  "success": true,
  "data": [...],
  "pagination": {
    "currentPage": 1,
    "totalPages": 5,
    "totalItems": 95
  }
}

7.3. GET USER LOGIN HISTORY (Admin)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/login-history/users/{userId}/history
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": [...]
}

7.4. GET LOGIN STATISTICS (Admin)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/login-history/statistics
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "totalLogins": 5000,
    "successfulLogins": 4800,
    "failedLogins": 200,
    "uniqueUsers": 350,
    "averageLoginsPerDay": 150,
    "topLocations": [
      {"country": "USA", "count": 2000},
      {"country": "UK", "count": 1500}
    ]
  }
}

7.5. CLEAR OLD LOGIN HISTORY (Admin)
--------------------------------------------------------------------------------
POST http://localhost:3000/api/login-history/clear-old
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "olderThanDays": 90
}

Expected Response:
{
  "success": true,
  "message": "Deleted 150 old login records"
}

================================================================================
8. ADMIN USER MANAGEMENT ENDPOINTS
================================================================================

8.1. GET ALL USERS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/users
Headers: Authorization: Bearer ADMIN_TOKEN

Query Parameters:
- page: 1
- limit: 10
- role: client, agency, admin
- kycStatus: pending, approved, rejected
- isBanned: true, false
- search: username or email
- sortBy: createdAt, username, email
- sortOrder: asc, desc

Example:
GET http://localhost:3000/api/admin/users?page=1&limit=10&role=client&kycStatus=approved

Expected Response:
{
  "success": true,
  "data": [
    {
      "_id": "...",
      "username": "johndoe",
      "email": "john@example.com",
      "role": "client",
      "kycStatus": "approved",
      "isBanned": false,
      "createdAt": "2025-11-26T..."
    },
    ...
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 10,
    "totalItems": 95
  }
}

8.2. GET USER STATISTICS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/users/statistics
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "totalUsers": 500,
    "activeUsers": 450,
    "bannedUsers": 50,
    "byRole": {
      "client": 400,
      "agency": 80,
      "admin": 20
    },
    "byKycStatus": {
      "pending": 100,
      "approved": 350,
      "rejected": 50
    },
    "newUsersThisMonth": 50,
    "newUsersThisWeek": 12
  }
}

8.3. EXPORT USERS TO CSV
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/users/export
Headers: Authorization: Bearer ADMIN_TOKEN

Query Parameters:
- role: client, agency
- kycStatus: pending, approved, rejected

Response: CSV file download

8.4. GET USER BY ID
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/users/{userId}
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "_id": "...",
    "username": "johndoe",
    "email": "john@example.com",
    "role": "client",
    "kycStatus": "approved",
    "loginHistory": [...],
    ...
  }
}

8.5. UPDATE USER
--------------------------------------------------------------------------------
PUT http://localhost:3000/api/admin/users/{userId}
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "email": "newemail@example.com",
  "phoneNumber": "+9876543210",
  "kycStatus": "approved"
}

Expected Response:
{
  "success": true,
  "message": "User updated successfully",
  "data": {...}
}

8.6. DELETE USER
--------------------------------------------------------------------------------
DELETE http://localhost:3000/api/admin/users/{userId}
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "message": "User deleted successfully"
}

8.7. BAN USER
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/users/{userId}/ban
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "reason": "Violated terms of service",
  "duration": 30
}

Expected Response:
{
  "success": true,
  "message": "User banned successfully"
}

8.8. UNBAN USER
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/users/{userId}/unban
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "message": "User unbanned successfully"
}

8.9. CHANGE USER ROLE
--------------------------------------------------------------------------------
PUT http://localhost:3000/api/admin/users/{userId}/role
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "role": "admin"
}

Expected Response:
{
  "success": true,
  "message": "User role updated successfully"
}

8.10. BULK BAN USERS
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/users/bulk/ban
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "userIds": ["user_id_1", "user_id_2", "user_id_3"],
  "reason": "Spam accounts",
  "duration": 30
}

Expected Response:
{
  "success": true,
  "message": "3 users banned successfully"
}

8.11. BULK DELETE USERS
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/users/bulk/delete
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "userIds": ["user_id_1", "user_id_2"]
}

Expected Response:
{
  "success": true,
  "message": "2 users deleted successfully"
}

8.12. BULK UPDATE ROLE
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/users/bulk/role
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "userIds": ["user_id_1", "user_id_2"],
  "role": "client"
}

Expected Response:
{
  "success": true,
  "message": "2 users updated successfully"
}

8.13. EXPORT STATISTICS TO PDF
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/statistics/export-pdf
Headers: Authorization: Bearer ADMIN_TOKEN

Response: PDF file download

================================================================================
9. ADMIN AGENCY MANAGEMENT ENDPOINTS
================================================================================

9.1. GET ALL AGENCIES
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/agencies
Headers: Authorization: Bearer ADMIN_TOKEN

Query Parameters:
- page: 1
- limit: 10
- status: pending, approved, rejected, suspended
- search: agency name

Expected Response:
{
  "success": true,
  "data": [
    {
      "_id": "...",
      "userId": "...",
      "companyName": "Rental Cars Inc",
      "status": "approved",
      "licenseNumber": "ABC123",
      "createdAt": "2025-11-26T..."
    },
    ...
  ],
  "pagination": {...}
}

9.2. GET AGENCY STATISTICS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/agencies/statistics
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "totalAgencies": 80,
    "pending": 10,
    "approved": 60,
    "rejected": 5,
    "suspended": 5
  }
}

9.3. GET AGENCY BY ID
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/agencies/{agencyId}
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "_id": "...",
    "companyName": "Rental Cars Inc",
    "status": "approved",
    "documents": [...],
    ...
  }
}

9.4. APPROVE AGENCY
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/agencies/{agencyId}/approve
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "comments": "All documents verified"
}

Expected Response:
{
  "success": true,
  "message": "Agency approved successfully"
}

9.5. REJECT AGENCY
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/agencies/{agencyId}/reject
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "reason": "Invalid license documents"
}

Expected Response:
{
  "success": true,
  "message": "Agency rejected"
}

9.6. SUSPEND AGENCY
--------------------------------------------------------------------------------
POST http://localhost:3000/api/admin/agencies/{agencyId}/suspend
Headers: Authorization: Bearer ADMIN_TOKEN

Body (JSON):
{
  "reason": "Multiple customer complaints",
  "duration": 30
}

Expected Response:
{
  "success": true,
  "message": "Agency suspended successfully"
}

9.7. DELETE AGENCY
--------------------------------------------------------------------------------
DELETE http://localhost:3000/api/admin/agencies/{agencyId}
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "message": "Agency deleted successfully"
}

================================================================================
10. ADMIN INSURANCE MANAGEMENT ENDPOINTS
================================================================================

10.1. GET ALL INSURANCE COMPANIES
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/insurance
Headers: Authorization: Bearer ADMIN_TOKEN

Query Parameters:
- page: 1
- limit: 10
- status: pending, approved, rejected, suspended

Expected Response:
{
  "success": true,
  "data": [
    {
      "_id": "...",
      "companyName": "SafeDrive Insurance",
      "status": "approved",
      "licenseNumber": "INS-123",
      ...
    },
    ...
  ],
  "pagination": {...}
}

10.2. GET INSURANCE STATISTICS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/admin/insurance/statistics
Headers: Authorization: Bearer ADMIN_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "totalInsuranceCompanies": 50,
    "pending": 5,
    "approved": 40,
    "rejected": 3,
    "suspended": 2
  }
}

10.3. APPROVE/REJECT/SUSPEND/DELETE INSURANCE
--------------------------------------------------------------------------------
Similar to Agency endpoints:
- POST /api/admin/insurance/{insuranceId}/approve
- POST /api/admin/insurance/{insuranceId}/reject
- POST /api/admin/insurance/{insuranceId}/suspend
- DELETE /api/admin/insurance/{insuranceId}

================================================================================
11. AGENCY PROFILE ENDPOINTS (Agency Users)
================================================================================

11.1. CREATE/UPDATE AGENCY PROFILE
--------------------------------------------------------------------------------
POST http://localhost:3000/api/agency/profile
PUT http://localhost:3000/api/agency/profile
Headers: Authorization: Bearer AGENCY_TOKEN

Body (JSON):
{
  "companyName": "Premium Rentals LLC",
  "licenseNumber": "LIC-12345",
  "address": {
    "street": "456 Business Ave",
    "city": "Los Angeles",
    "state": "CA",
    "zipCode": "90001",
    "country": "USA"
  },
  "contactInfo": {
    "phone": "+1234567890",
    "email": "contact@premiumrentals.com",
    "website": "https://premiumrentals.com"
  },
  "businessHours": {
    "monday": "9:00-18:00",
    "tuesday": "9:00-18:00"
  },
  "description": "Premium car rental services"
}

Expected Response:
{
  "success": true,
  "message": "Agency profile created/updated successfully",
  "data": {...}
}

11.2. GET AGENCY PROFILE
--------------------------------------------------------------------------------
GET http://localhost:3000/api/agency/profile
Headers: Authorization: Bearer AGENCY_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "companyName": "Premium Rentals LLC",
    "status": "approved",
    "licenseNumber": "LIC-12345",
    ...
  }
}

11.3. UPLOAD AGENCY DOCUMENTS
--------------------------------------------------------------------------------
POST http://localhost:3000/api/agency/documents
Headers: Authorization: Bearer AGENCY_TOKEN

Body (form-data):
- businessLicense: [File]
- insuranceCertificate: [File]
- taxDocument: [File]

Expected Response:
{
  "success": true,
  "message": "Documents uploaded successfully"
}

11.4. GET AGENCY DASHBOARD STATS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/agency/dashboard/stats
Headers: Authorization: Bearer AGENCY_TOKEN

Expected Response:
{
  "success": true,
  "data": {
    "totalVehicles": 50,
    "activeReservations": 12,
    "totalRevenue": 150000,
    "averageRating": 4.5
  }
}

11.5. GET ALL AGENCIES (Public)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/agency/all

Query Parameters:
- page: 1
- limit: 10
- city: "Los Angeles"

Expected Response:
{
  "success": true,
  "data": [
    {
      "companyName": "Premium Rentals LLC",
      "rating": 4.5,
      "address": {...}
    },
    ...
  ]
}

11.6. GET AGENCY BY ID (Public)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/agency/{agencyId}

Expected Response:
{
  "success": true,
  "data": {
    "companyName": "Premium Rentals LLC",
    "description": "Premium car rental services",
    "rating": 4.5,
    "totalReviews": 120
  }
}

================================================================================
12. INSURANCE PROFILE ENDPOINTS (Insurance Users)
================================================================================

12.1. CREATE/UPDATE INSURANCE PROFILE
--------------------------------------------------------------------------------
POST http://localhost:3000/api/insurance/profile
PUT http://localhost:3000/api/insurance/profile
Headers: Authorization: Bearer INSURANCE_TOKEN

Body (JSON):
{
  "companyName": "SafeDrive Insurance Co",
  "licenseNumber": "INS-98765",
  "coverageTypes": ["collision", "liability", "comprehensive"],
  "contactInfo": {...},
  "address": {...}
}

Expected Response:
{
  "success": true,
  "message": "Insurance profile created/updated successfully"
}

12.2. GET INSURANCE PROFILE
--------------------------------------------------------------------------------
GET http://localhost:3000/api/insurance/profile
Headers: Authorization: Bearer INSURANCE_TOKEN

12.3. UPLOAD INSURANCE DOCUMENTS
--------------------------------------------------------------------------------
POST http://localhost:3000/api/insurance/documents
Headers: Authorization: Bearer INSURANCE_TOKEN

Body (form-data):
- insuranceLicense: [File]
- certificationDocs: [File]

12.4. GET INSURANCE DASHBOARD STATS
--------------------------------------------------------------------------------
GET http://localhost:3000/api/insurance/dashboard/stats
Headers: Authorization: Bearer INSURANCE_TOKEN

12.5. GET ALL INSURANCE COMPANIES (Public)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/insurance/all

12.6. GET INSURANCE BY ID (Public)
--------------------------------------------------------------------------------
GET http://localhost:3000/api/insurance/{insuranceId}

================================================================================
ERROR RESPONSES
================================================================================

1. Validation Error (400):
{
  "success": false,
  "message": "Validation failed",
  "errors": [
    {
      "field": "email",
      "message": "Invalid email format"
    }
  ]
}

2. Authentication Error (401):
{
  "success": false,
  "message": "Invalid credentials"
}
OR
{
  "success": false,
  "message": "Token expired"
}

3. Authorization Error (403):
{
  "success": false,
  "message": "Access denied. Admin role required."
}

4. Not Found Error (404):
{
  "success": false,
  "message": "User not found"
}

5. Conflict Error (409):
{
  "success": false,
  "message": "Username already exists"
}

6. Server Error (500):
{
  "success": false,
  "message": "Internal server error"
}

================================================================================
TESTING WORKFLOW EXAMPLES
================================================================================

WORKFLOW 1: Complete User Registration → KYC → Login
-------------------------------------------------------
1. Register new user
   POST /api/auth/register

2. Login to get tokens
   POST /api/auth/login

3. Get profile
   GET /api/users/profile

4. Submit KYC documents
   POST /api/kyc/submit

5. Check KYC status
   GET /api/kyc/status

6. (Admin) Review KYC
   POST /api/kyc/admin/{userId}/review

7. Login again to see updated KYC status
   POST /api/auth/login

WORKFLOW 2: Enable 2FA
-------------------------------------------------------
1. Login
   POST /api/auth/login

2. Enable 2FA
   POST /api/2fa/enable
   → Save QR code and backup codes

3. Verify setup
   POST /api/2fa/verify-setup

4. Logout
   POST /api/auth/logout

5. Login (will require 2FA)
   POST /api/auth/login
   → Get tempToken

6. Complete 2FA
   POST /api/auth/login-2fa

WORKFLOW 3: Face Authentication
-------------------------------------------------------
1. Login
   POST /api/auth/login

2. Enable face auth (upload images)
   POST /api/auth/enable-face-auth

3. Logout
   POST /api/auth/logout

4. Login with face
   POST /api/auth/login-face

WORKFLOW 4: Admin User Management
-------------------------------------------------------
1. Admin login
   POST /api/auth/login

2. Get all users
   GET /api/admin/users?page=1&limit=10

3. Get user statistics
   GET /api/admin/users/statistics

4. Ban specific user
   POST /api/admin/users/{userId}/ban

5. Export users to CSV
   GET /api/admin/users/export

WORKFLOW 5: Agency Registration & Approval
-------------------------------------------------------
1. Register as agency
   POST /api/auth/register (role: agency)

2. Login as agency
   POST /api/auth/login

3. Create agency profile
   POST /api/agency/profile

4. Upload documents
   POST /api/agency/documents

5. (Admin) Review agency
   POST /api/admin/agencies/{agencyId}/approve

6. Get agency dashboard
   GET /api/agency/dashboard/stats

================================================================================
POSTMAN COLLECTION SETUP TIPS
================================================================================

1. Environment Variables:
   - base_url: http://localhost:3001/api/v1
   - access_token: (set after login)
   - refresh_token: (set after login)
   - admin_token: (set after admin login)
   - user_id: (set after registration/login)

2. Pre-request Scripts:
   // Set auth header
   pm.request.headers.add({
     key: 'Authorization',
     value: 'Bearer ' + pm.environment.get('access_token')
   });

3. Test Scripts:
   // Save tokens
   var response = pm.response.json();
   if (response.data && response.data.accessToken) {
     pm.environment.set('access_token', response.data.accessToken);
     pm.environment.set('refresh_token', response.data.refreshToken);
   }
   
   // Save user ID
   if (response.data && response.data.user) {
     pm.environment.set('user_id', response.data.user._id);
   }

4. Folder Structure:
   - Auth
     - Register
     - Login
     - Refresh Token
     - Logout
     - Face Auth
   - User Profile
   - KYC
   - 2FA
   - Password Reset
   - Login History
   - Admin
     - Users
     - Agencies
     - Insurance
     - KYC Review
   - Agency
   - Insurance

================================================================================
NOTES
================================================================================
- Default port: 3001 (direct), 3000 (via gateway)
- JWT expiration: 30 minutes (access), 7 days (refresh)
- File uploads: Max 10MB per file
- Password requirements: Min 8 chars, 1 uppercase, 1 lowercase, 1 number
- KYC document types: nationalIdFront, nationalIdBack, drivingLicenseFront, 
  drivingLicenseBack, proofOfAddress, selfie
- User roles: client, agency, insurance, admin
- KYC statuses: not_submitted, pending, approved, rejected

================================================================================
