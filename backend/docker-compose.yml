# Docker Compose for E-Krini Car Rental Platform

services:
  # API Gateway
  gateway-service:
    build: ./gateway-service
    container_name: e-krini-gateway
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=development
      - PORT=4000
    volumes:
      - ./gateway-service:/app
      - /app/node_modules
    restart: unless-stopped

  # Discovery Service
  discovery-service:
    build: ./discovery-service
    container_name: e-krini-discovery
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - PORT=3000
      - FLEET_SERVICE_URL=http://fleet-service:3002
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - RESERVATION_SERVICE_URL=http://reservation-service:3003
      - PROMOTION_SERVICE_URL=http://promotion-coupon-service:3006
      - MAINTENANCE_SERVICE_URL=http://maintenance-service:3007
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    restart: unless-stopped

  # Auth & User Service
  auth-user-service:
    build: ./auth-user-service
    container_name: e-krini-auth-service
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/car-rental-auth
      - ACCESS_TOKEN_SECRET=${JWT_SECRET:-your-secret-key-change-in-production}
      - REFRESH_TOKEN_SECRET=${JWT_REFRESH_SECRET:-your-refresh-secret}
      - JWT_EXPIRES_IN=15m
      - JWT_REFRESH_EXPIRES_IN=7d
    depends_on:
      - mongo

    restart: unless-stopped

  # Fleet Service
  fleet-service:
    build: ./fleet-service
    container_name: e-krini-fleet-service
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - PORT=3002
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/car-rental-fleet
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - RESERVATION_SERVICE_URL=http://reservation-service:3003
      - PROMOTION_SERVICE_URL=http://promotion-coupon-service:3006
      - MAINTENANCE_SERVICE_URL=http://maintenance-service:3007
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    depends_on:
      - mongo

    restart: unless-stopped

  # Reservation Service
  reservation-service:
    build: ./reservation-service
    container_name: e-krini-reservation-service
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
      - PORT=3003
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/car-rental-reservations
      - REDIS_URL=redis://redis:6379
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
      - FLEET_SERVICE_URL=http://fleet-service:3002
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - PROMOTION_SERVICE_URL=http://promotion-coupon-service:3006
      - MAINTENANCE_SERVICE_URL=http://maintenance-service:3007
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    depends_on:
      - mongo
      - redis

    restart: unless-stopped

  # Assurance Claims Service
  assurence-claims-service:
    build: ./assurence-claims-service
    container_name: e-krini-assurance-service
    ports:
      - "3004:3004"
    environment:
      - NODE_ENV=development
      - PORT=3004
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/assurance-claims-db
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
    depends_on:
      - mongo

    restart: unless-stopped

  # Feedback Complaints Service
  feedback-complaints-service:
    build: ./feedback-complaints-service
    container_name: e-krini-feedback-service
    ports:
      - "3005:3005"
    environment:
      - NODE_ENV=development
      - PORT=3005
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/ekrini-feedback
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
      - FLEET_SERVICE_URL=http://fleet-service:3002
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - RESERVATION_SERVICE_URL=http://reservation-service:3003
      - MAINTENANCE_SERVICE_URL=http://maintenance-service:3007
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    depends_on:
      - mongo

    restart: unless-stopped

  # Promotion Coupon Service
  promotion-coupon-service:
    build: ./promotion-coupon-service
    container_name: e-krini-promotion-service
    ports:
      - "3006:3006"
    environment:
      - NODE_ENV=development
      - PORT=3006
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/promotion-coupon_db
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
      - FLEET_SERVICE_URL=http://fleet-service:3002
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - RESERVATION_SERVICE_URL=http://reservation-service:3003
      - MAINTENANCE_SERVICE_URL=http://maintenance-service:3007
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    depends_on:
      - mongo

    restart: unless-stopped

  # Maintenance Service
  maintenance-service:
    build: ./maintenance-service
    container_name: e-krini-maintenance-service
    ports:
      - "3007:3007"
    environment:
      - NODE_ENV=development
      - PORT=3007
      - HOST=0.0.0.0
      - MONGODB_URI=mongodb://mongo:27017/maintenance
      - ACCESS_TOKEN_SECRET=your-secret-key-change-in-production
      - FLEET_SERVICE_URL=http://fleet-service:3002
      - AUTH_SERVICE_URL=http://auth-user-service:3001
      - RESERVATION_SERVICE_URL=http://reservation-service:3003
      - ASSURANCE_SERVICE_URL=http://assurence-claims-service:3004
    depends_on:
      - mongo

    restart: unless-stopped

  # MongoDB
  mongo:
    image: mongo:6
    container_name: e-krini-mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped

  # Redis (for caching and sessions)
  redis:
    image: redis:7-alpine
    container_name: e-krini-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

    restart: unless-stopped

volumes:
  mongo-data:
  redis-data:
